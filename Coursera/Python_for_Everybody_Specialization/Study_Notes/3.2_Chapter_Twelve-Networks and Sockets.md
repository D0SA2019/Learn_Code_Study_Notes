# 3.2 Chapter 12 - Networks and Sockets

## Transport Control Protocol (TCP)
Built on top IP (Internet Protocol)

Assumes IP might lose some data stores and retransmits data if it seems to be lost

Handles "flow control" using a transmit window

Provides a nice reliable pipe

![](https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/IP_stack_connections_%28corrected%29.svg/2000px-IP_stack_connections_%28corrected%29.svg.png)

### TCP Connections / Sockets
The network protocol that powers the web is actually quite simple and there is built-in support in Python called `sockets` which makes it very easy to make network connections and retrieve data over those sockets in a Python program.

A socket is much like a file, except that a single socket provides a two-way connection between two programs. You can both read from and write to the same socket. If you write something to a socket, it is sent to the application at the other end of the socket. If you read from the socket, you are given the data which the other application has sent.

But if you try to read a socket when the program on the other end of the socket has not sent any data, you just sit and wait. If the programs on both ends of the socket simply wait for some data without sending anything, they will wait for a very long time, so an important part of programs that communicate over the Internet is to have some sort of protocol.

A protocol is a set of precise rules that determine who is to go first, what they are to do, and then what the responses are to that message, and who sends next, and so on. In a sense the two applications at either end of the socket are doing a dance and making sure not to step on each other's toes.

"In computer networking, an Internet socket or network socket is an endpoint of a bidirectional inter-process communication flow across an Internet Protocol-based computer network, such as the Internet."

Process -> Internet -> Process

### TCP Port Numbers
A port is an application-specific or process-specific software communications endpoint

It allows multiple networked applications to coexist to coexist on the same server.

There is a list of well-known TCP port numbers

![](http://i66.tinypic.com/2ldgcvl.png)

We're going to play within this class the most is port 80. Port 80 is the web port because that's the part that connected to the server. Port 443 is the secure HTTPS.

### Common TCP Ports

* Telnet (23) - Login
* SSH (22) - Secure Login
* HTTP (80)
* HTTPS (443) - Secure
* SMTP (25) - Mail
* IMAP (143/220/993) - Mail Retrieval
* POP (109/110) - Mail Revrieval
* DNS (53) - Domain Name
* FTP (21) - File Transfer

Sometimes we see the port number in the URL if the web server is running on a "non-standart" port.

![](http://i64.tinypic.com/14v7nu1.png)


### Sockets in Python
Python has built-in support for TCP Sockets

```python
import socket
mysock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
mysock.connect(("data.pr4e.org", 80))
```


## Aplication Protocol
Since TCP (and Python) gives us a reliable socket, what do we want to do with the socket? What problem do we want to solve?

Application Protocols
* Mail
* World Wide Web

### HTTP - Hypertext Transfer Protocol
* The dominant Application Layer Protocol on the Internet
* Invented for the Web - to Retrieve HTML, Images, Documents, etc
* Extended to be data in addition to documents - RSS, Web Services, etc. Basic Concept - Make a Connection - Request a document - Retrieve the Document - Close the Connection

### What is a Protocol?
A set of rules that all parties follow so we can predict each orhet's behavior

And not bump into each other
* On wto-way roads in USA, drive on the right-hand side of the road
* On two-way roads in the UK drive on the left-hand side of the road

![](http://i68.tinypic.com/vzc5cw.png)

### Getting Data From The server
Each the user clicks on an anchor tag with an href= value to switch to a new page, the browser makes a connection to the web server and issues a "GET" request - to GET the content of the page at the specified URL.

The server returns the HTML document to the browser wich formats and displays the document to the user.

**Request Response Cycle**

![](http://i65.tinypic.com/6sw8m1.png)

### Internet Standarts
The standarts for all of the Internet protocols (inner workings) are developed by an organizaton Internet Engineering Task Force [(IETF)](http://www.ietf.org)

Standarts are colled "RFCs" - "Request for Comments"

![](http://i68.tinypic.com/2zey1xz.png)

![](http://i66.tinypic.com/2dtdtls.png)

![](http://i64.tinypic.com/2lwobaf.png)

```
Heval:~ hevalhazalkurt$ telnet data.pr4e.org 80
Trying 192.241.136.170...
Connected to data.pr4e.org.
Escape character is '^]'.
GET http://data.pr4e.org/page1.htm HTTP/1.0

HTTP/1.1 200 OK
Date: Tue, 08 Jan 2019 04:01:00 GMT
Server: Apache/2.4.18 (Ubuntu)
Last-Modified: Mon, 15 May 2017 11:11:47 GMT
ETag: "80-54f8e1f004857"
Accept-Ranges: bytes
Content-Length: 128
Cache-Control: max-age=0, no-cache, no-store, must-revalidate
Pragma: no-cache
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Connection: close
Content-Type: text/html

<h1>The First Page</h1>
<p>
If you like, you can switch to the
<a href="http://data.pr4e.org/page2.htm">
Second Page</a>.
</p>
Connection closed by foreign host.
Heval:~ hevalhazalkurt$
```

Nmap in the movies : https://nmap.org/movies/

### An HTTP Request in Python

```python
import socket

mysock = socket.socket(socket.AF_INET, socket.SOCT_STREAM)
mysock.connect(("data.pr4e.org", 80))
cmd = "Get http://data.pr4e.org/romeo.txt HTTP/1.0\r\n\r\n".encode()
mysock.send(cmd)

while True:
	data = mysock.recv(512)
	if (len(data) <1):
		break
	print(data.decode())
mysock.close()

# Output :
HTTP/1.1 501 Not Implemented
Date: Tue, 08 Jan 2019 04:11:27 GMT
Server: Apache/2.4.18 (Ubuntu)
Allow: GET,HEAD,POST,OPTIONS
Content-Length: 279
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>501 Not Implemented</title>
</head><body>
<h1>Not Implemented</h1>
<p>Get to /romeo.txt not supported.<br />
</p>
<hr>
<address>Apache/2.4.18 (Ubuntu) Server at data.pr4e.org Port 80</address>
</body></html>
```



### Worked Exercise : `socket1.py`
Sample Codes download : https://py4e.com/materials.php

```python
import socket

mysock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
mysock.connect(('data.pr4e.org', 80))
cmd = 'GET http://data.pr4e.org/romeo.txt HTTP/1.0\r\n\r\n'.encode()
mysock.send(cmd)

while True:
    data = mysock.recv(512)
    if len(data) < 1:
        break
    print(data.decode(),end='')

mysock.close()

# Output :
HTTP/1.1 200 OK
Date: Tue, 08 Jan 2019 04:22:31 GMT
Server: Apache/2.4.18 (Ubuntu)
Last-Modified: Sat, 13 May 2017 11:22:22 GMT
ETag: "a7-54f6609245537"
Accept-Ranges: bytes
Content-Length: 167
Cache-Control: max-age=0, no-cache, no-store, must-revalidate
Pragma: no-cache
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Connection: close
Content-Type: text/plain

But soft what light through yonder window breaks
It is the east and Juliet is the sun
Arise fair sun and kill the envious moon
Who is already sick and pale with grief
```

## Using the Developer Console to Explore HTTP
Go to URL -> Open the browser's Developer Tools

![](http://i65.tinypic.com/npid6r.png)

![](http://i66.tinypic.com/24fldtd.png)

![](http://i65.tinypic.com/ilxh0g.png)

You get these exact same headers either in Python or with Telnet or with the developer console. When you connect with the same web address by Telnet and use the `GET` command you'll see the line `HTTP/1.1 200 OK` like the picture below.

![](http://i66.tinypic.com/5baxx.png)

On the "Response" tab :

![](http://i64.tinypic.com/2pzbhpg.png)

Go to the : https://www.wa4e.com/code/arrays/guess.php?guess=12
You'll see the PHP questioning on the "Header" tab

![](http://i68.tinypic.com/aenvbl.png)
